#,Question,Actual Query,involved_tables,executed,record_count,expected_answer,primary_keys
301,"Create a recursive CTE to show the full management hierarchy for all employees, including their level.","WITH Emp_CTE AS (SELECT BusinessEntityID, OrganizationNode, OrganizationLevel, JobTitle, CAST(JobTitle AS nvarchar(MAX)) AS HierarchyPath FROM HumanResources.Employee WHERE OrganizationLevel = 0 UNION ALL SELECT e.BusinessEntityID, e.OrganizationNode, e.OrganizationLevel, e.JobTitle, ecte.HierarchyPath + ' -> ' + e.JobTitle FROM HumanResources.Employee e INNER JOIN Emp_CTE ecte ON e.OrganizationNode.GetAncestor(1) = ecte.OrganizationNode) SELECT * FROM Emp_CTE;",HumanResources.Employee,success,0,,
302,"Use a recursive CTE to explode the Bill of Materials for a specific assembly (e.g., ProductID 722).","WITH BOM_CTE AS (SELECT ProductAssemblyID, ComponentID, PerAssemblyQty, BOMLevel FROM Production.BillOfMaterials WHERE ProductAssemblyID = 722 UNION ALL SELECT b.ProductAssemblyID, b.ComponentID, b.PerAssemblyQty, b.BOMLevel FROM Production.BillOfMaterials b INNER JOIN BOM_CTE cte ON b.ProductAssemblyID = cte.ComponentID) SELECT b.*, p.Name FROM BOM_CTE b JOIN Production.Product p ON b.ComponentID = p.ProductID;","Production.BillOfMaterials, Production.Product",success,27,,"[[316, 486], [324, 486], [327, 483], [331, 482], [350, 486], [399, 485], [531, 487], [532, 484], [532, 484], [533, 478]]"
303,Pivot total sales by year and territory group.,"SELECT * FROM (SELECT YEAR(soh.OrderDate) AS [Year], st.[Group], soh.TotalDue FROM Sales.SalesOrderHeader soh JOIN Sales.SalesTerritory st ON soh.TerritoryID = st.TerritoryID) AS SourceTable PIVOT (SUM(TotalDue) FOR [Group] IN ([North America], [Europe], [Pacific])) AS PivotTable;","Sales.SalesOrderHeader, Sales.SalesTerritory",success,4,,
304,Identify gaps in the sequence of sales order ID values.,"WITH Seq AS (SELECT SalesOrderID, LEAD(SalesOrderID) OVER (ORDER BY SalesOrderID) AS NextID FROM Sales.SalesOrderHeader) SELECT SalesOrderID + 1 AS GapStart, NextID - 1 AS GapEnd FROM Seq WHERE NextID - SalesOrderID > 1;",Sales.SalesOrderHeader,success,0,,
305,Extract the 'YearsExperience' from the XML resume of JobCandidates (requires XML namespace).,"WITH XMLNAMESPACES ('http://schemas.microsoft.com/sqlserver/2004/07/adventure-works/Resume' AS res) SELECT JobCandidateID, Resume.value('(/res:Resume/res:Employment/res:Emp.Duration)[1]', 'nvarchar(max)') AS Experience FROM HumanResources.JobCandidate;",HumanResources.JobCandidate,"failed: ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]XQuery [HumanResources.JobCandidate.Resume.value()]: There is no element named ""{http://schemas.microsoft.com/sqlserver/2004/07...",,,
306,Calculate the median list price of products within each category without using PERCENTILE_CONT.,"WITH Ranked AS (SELECT pc.Name AS Category, p.ListPrice, ROW_NUMBER() OVER (PARTITION BY pc.Name ORDER BY p.ListPrice) AS RowDesc, COUNT(*) OVER (PARTITION BY pc.Name) AS TotalCount FROM Production.Product p JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID) SELECT Category, AVG(ListPrice) AS Median FROM Ranked WHERE RowDesc BETWEEN TotalCount / 2.0 AND TotalCount / 2.0 + 1 GROUP BY Category;","Production.Product, Production.ProductCategory, Production.ProductSubcategory",success,4,,
307,Calculate a 3-month moving average of total sales for the entire company.,"WITH MonthlySales AS (SELECT CAST(FORMAT(OrderDate, 'yyyy-MM-01') AS date) AS MonthStart, SUM(TotalDue) AS MonthlyTotal FROM Sales.SalesOrderHeader GROUP BY FORMAT(OrderDate, 'yyyy-MM-01')) SELECT MonthStart, MonthlyTotal, AVG(MonthlyTotal) OVER (ORDER BY MonthStart ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS MovingAvg FROM MonthlySales;",Sales.SalesOrderHeader,success,38,,
308,"Find ""Islands"" of consecutive days where at least one sales order was placed.","WITH Dates AS (SELECT DISTINCT CAST(OrderDate AS date) AS DDate FROM Sales.SalesOrderHeader), Groups AS (SELECT DDate, DATEADD(day, -ROW_NUMBER() OVER (ORDER BY DDate), DDate) AS Grp FROM Dates) SELECT MIN(DDate) AS IslandStart, MAX(DDate) AS IslandEnd, COUNT(*) AS ConsecutiveDays FROM Groups GROUP BY Grp;",Sales.SalesOrderHeader,success,4,,
309,List all possible combinations of products and territories that have never had a sale.,"SELECT p.ProductID, t.TerritoryID FROM Production.Product p CROSS JOIN Sales.SalesTerritory t EXCEPT SELECT sod.ProductID, soh.TerritoryID FROM Sales.SalesOrderHeader soh JOIN Sales.SalesOrderDetail sod ON soh.SalesOrderID = sod.SalesOrderID;","Production.Product, Sales.SalesOrderDetail, Sales.SalesOrderHeader, Sales.SalesTerritory",success,1000,,"[[1, 2], [1, 5], [1, 7], [1, 8], [1, 10], [2, 3], [2, 6], [2, 9], [3, 1], [3, 4]]"
310,Parse the 'Demographics' XML in Person.Person to extract the 'TotalPurchaseYTD' for individuals.,"WITH XMLNAMESPACES ('http://schemas.microsoft.com/sqlserver/2004/07/adventure-works/IndividualSurvey' AS ns) SELECT BusinessEntityID, Demographics.value('(/ns:IndividualSurvey/ns:TotalPurchaseYTD)[1]', 'money') AS TotalPurchaseYTD FROM Person.Person WHERE Demographics IS NOT NULL;",Person.Person,success,1000,,"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
311,Calculate the month-over-month growth percentage of sales per sales person.,"WITH Sales_CTE AS (SELECT SalesPersonID, YEAR(OrderDate) AS Yr, MONTH(OrderDate) AS Mo, SUM(TotalDue) AS CurrentSales FROM Sales.SalesOrderHeader WHERE SalesPersonID IS NOT NULL GROUP BY SalesPersonID, YEAR(OrderDate), MONTH(OrderDate)), LaggedS",Sales.SalesOrderHeader,"failed: ('42000', ""[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near 'LaggedS'. (102) (SQLExecDirectW)"")",,,
312,Retrieve the top 1% of customers by total spend.,"SELECT * FROM (SELECT CustomerID, SUM(TotalDue) AS TotalSpent, NTILE(100) OVER (ORDER BY SUM(TotalDue) DESC) AS Percentile FROM Sales.SalesOrderHeader GROUP BY CustomerID) AS t WHERE Percentile = 1;",Sales.SalesOrderHeader,success,192,,"[29486, 29488, 29489, 29497, 29499, 29504, 29507, 29509, 29511, 29513]"
313,Find all SalesPersons who have sold products to every single store in their assigned territory.,"SELECT sp.BusinessEntityID FROM Sales.SalesPerson sp JOIN Sales.SalesOrderHeader soh ON sp.BusinessEntityID = soh.SalesPersonID JOIN Sales.Customer c ON soh.CustomerID = c.CustomerID WHERE c.StoreID IS NOT NULL GROUP BY sp.BusinessEntityID, sp.TerritoryID HAVING COUNT(DISTINCT c.StoreID) = (SELECT COUNT(*) FROM Sales.Store s JOIN Sales.Customer cust ON s.BusinessEntityID = cust.StoreID WHERE cust.TerritoryID = sp.TerritoryID);","Sales.Customer, Sales.SalesOrderHeader, Sales.SalesPerson, Sales.Store",success,0,,
314,"Use UNPIVOT to transform sales YTD, sales last year, cost YTD, and cost last year in sales territory into rows.","SELECT TerritoryID, MetricName, MetricValue FROM (SELECT TerritoryID, SalesYTD, SalesLastYear, CostYTD, CostLastYear FROM Sales.SalesTerritory) AS t UNPIVOT (MetricValue FOR MetricName IN (SalesYTD, SalesLastYear, CostYTD, CostLastYear)) AS Unpvt;",Sales.SalesTerritory,success,40,,"[1, 1, 1, 1, 2, 2, 2, 2, 3, 3]"
315,Find the first order and last order date for each customer without using subqueries.,"SELECT DISTINCT CustomerID, FIRST_VALUE(OrderDate) OVER (PARTITION BY CustomerID ORDER BY OrderDate ASC) AS FirstOrder, FIRST_VALUE(OrderDate) OVER (PARTITION BY CustomerID ORDER BY OrderDate DESC) AS LastOrder FROM Sales.SalesOrderHeader;",Sales.SalesOrderHeader,success,1000,,"[11000, 11005, 11027, 11115, 11141, 11145, 11151, 11180, 11220, 11232]"
316,Identify products where the current inventory level is below the minimum reorder point across all locations.,"SELECT p.Name, p.ReorderPoint, SUM(pi.Quantity) AS TotalQty FROM Production.Product p JOIN Production.ProductInventory pi ON p.ProductID = pi.ProductID GROUP BY p.Name, p.ReorderPoint HAVING SUM(pi.Quantity) < p.ReorderPoint;","Production.Product, Production.ProductInventory",success,7,,
317,Extract the 'Telephone' info from 'AdditionalContactInfo' XML for people who have it.,"WITH XMLNAMESPACES ('http://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ContactInfo' AS ci) SELECT BusinessEntityID, AdditionalContactInfo.value('(/ci:AdditionalContactInfo/ci:Telephone/ci:number)[1]', 'nvarchar(50)') AS Phone FROM Person.Person WHERE AdditionalContactInfo IS NOT NULL;",Person.Person,"failed: ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]XQuery [Person.Person.AdditionalContactInfo.value()]: There is no element named ""{http://schemas.microsoft.com/sqlserver/2004/0...",,,
318,Calculate the cumulative percentage of total sales revenue contributed by each product.,"WITH Sales AS (SELECT ProductID, SUM(LineTotal) AS ProdTotal FROM Sales.SalesOrderDetail GROUP BY ProductID), Tot AS (SELECT SUM(LineTotal) AS GrandTotal FROM Sales.SalesOrderDetail) SELECT s.ProductID, (s.ProdTotal / t.GrandTotal) * 100 AS Pct, SUM(s.ProdTotal) OVER (ORDER BY s.ProdTotal DESC) / t.GrandTotal * 100 AS CumulativePct FROM Sales s CROSS JOIN Tot t;",Sales.SalesOrderDetail,success,266,,"[707, 708, 709, 710, 711, 712, 713, 714, 715, 716]"
319,Find SalesOrders where a single product item accounts for more than 50% of the total order value.,"SELECT SalesOrderID, ProductID, LineTotal FROM Sales.SalesOrderDetail sod WHERE LineTotal > (SELECT SUM(LineTotal) * 0.5 FROM Sales.SalesOrderDetail WHERE SalesOrderID = sod.SalesOrderID);",Sales.SalesOrderDetail,success,1000,,"[[43660, 758], [43663, 760], [43669, 747], [43670, 773], [43672, 776], [43674, 758], [43679, 770], [43686, 758], [43687, 765], [43690, 760]]"
320,Identify employees who have been with the company longer than their own manager.,"SELECT e.BusinessEntityID, e.HireDate, m.HireDate AS ManagerHireDate FROM HumanResources.Employee e JOIN HumanResources.Employee m ON e.OrganizationNode.GetAncestor(1) = m.OrganizationNode WHERE e.HireDate < m.HireDate;",HumanResources.Employee,success,99,,"[3, 8, 9, 12, 17, 26, 27, 28, 40, 48]"
321,Generate a cross-tab report of the number of products in each category vs color.,"SELECT * FROM (SELECT pc.Name AS Category, p.Color FROM Production.Product p JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID) AS src PIVOT (COUNT(Color) FOR Color IN ([Black], [Red], [White], [Blue], [Silver])) AS pvt;","Production.Product, Production.ProductCategory, Production.ProductSubcategory",success,4,,
322,Retrieve all ProductModels that contain the word 'Weld' in their manufacturing instructions (XML).,"SELECT Name FROM Production.ProductModel WHERE Instructions.exist('//*:step[contains(., ""Weld"")]') = 1;",Production.ProductModel,"failed: ('42000', ""[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]XQuery [Production.ProductModel.Instructions.exist()]: Cannot implicitly atomize or apply 'fn:data()' to complex content elemen...",,,
323,List the most recently modified address for each business entity.,"SELECT * FROM (SELECT BusinessEntityID, AddressID, ROW_NUMBER() OVER (PARTITION BY BusinessEntityID ORDER BY ModifiedDate DESC) AS rnk FROM Person.BusinessEntityAddress) AS t WHERE rnk = 1;",Person.BusinessEntityAddress,success,1000,,"[[1, 249], [2, 293], [3, 224], [4, 11387], [5, 190], [6, 286], [7, 49], [8, 230], [9, 187], [10, 11386]]"
324,Calculate the Z-Score of the list price for all products.,"WITH Stats AS (SELECT AVG(ListPrice) AS Mean, STDEV(ListPrice) AS StdDev FROM Production.Product) SELECT Name, ListPrice, (ListPrice - Mean) / StdDev AS ZScore FROM Production.Product CROSS JOIN Stats;",Production.Product,success,504,,
325,Find sales persons who had a decrease in sales for three consecutive months.,"WITH MonthlySales AS (SELECT SalesPersonID, YEAR(OrderDate) AS Yr, MONTH(OrderDate) AS Mo, SUM(TotalDue) AS Total FROM Sales.SalesOrderHeader WHERE SalesPersonID IS NOT NULL GROUP BY SalesPersonID, YEAR(OrderDate), MONTH(OrderDate)), Trends AS (SELECT *, LAG(Total) OVER (PARTITION BY SalesPersonID ORDER BY Yr, Mo) AS Prev1, LAG(Total, 2) OVER (PARTITION BY SalesPersonID ORDER BY Yr, Mo) AS Prev2 FROM MonthlySales) SELECT DISTINCT SalesPersonID FROM Trends WHERE Total < Prev1 AND Prev1 < Prev2;",Sales.SalesOrderHeader,success,16,,"[274, 275, 276, 277, 278, 279, 280, 281, 282, 283]"
326,Retrieve the average hire age of employees grouped by the decade they were born.,"SELECT (YEAR(BirthDate)/10)*10 AS BirthDecade, AVG(DATEDIFF(year, BirthDate, HireDate)) AS AvgHireAge FROM HumanResources.Employee GROUP BY (YEAR(BirthDate)/10)*10;",HumanResources.Employee,success,5,,
327,Rank territories by the ratio of current year sales vs last year sales.,"SELECT Name, SalesYTD, SalesLastYear, RANK() OVER (ORDER BY (SalesYTD/NULLIF(SalesLastYear, 0)) DESC) AS GrowthRank FROM Sales.SalesTerritory;",Sales.SalesTerritory,success,10,,
328,"Find all products whose name matches a regular expression-like pattern (e.g., starts with 'ML', followed by digits).",SELECT Name FROM Production.Product WHERE Name LIKE 'ML-[0-9]%';,Production.Product,success,0,,
329,Identify orders that have multiple special offers applied across different line items.,SELECT SalesOrderID FROM Sales.SalesOrderDetail GROUP BY SalesOrderID HAVING COUNT(DISTINCT SpecialOfferID) > 1;,Sales.SalesOrderDetail,success,1000,,"[43879, 44100, 44283, 44285, 44294, 44489, 44523, 44549, 44792, 44795]"
330,Calculate the 'Churn Rate' (Percentage of customers who ordered last year but not this year).,"DECLARE @MaxDate datetime = (SELECT MAX(OrderDate) FROM Sales.SalesOrderHeader); WITH LastYear AS (SELECT DISTINCT CustomerID FROM Sales.SalesOrderHeader WHERE OrderDate BETWEEN DATEADD(year, -2, @MaxDate) AND DATEADD(year, -1, @MaxDate)), ThisYear AS (SELECT DISTINCT CustomerID FROM Sales.SalesOrderHeader WHERE OrderDate > DATEADD(year, -1, @MaxDate)) SELECT (COUNT(ly.CustomerID) - COUNT(ty.CustomerID)) * 100.0 / COUNT(ly.CustomerID) AS ChurnRate FROM LastYear ly LEFT JOIN ThisYear ty ON ly.CustomerID = ty.CustomerID;",Sales.SalesOrderHeader,success,,18.369453044375,
331,Retrieve the XML schema collection names used in the database.,SELECT name FROM sys.xml_schema_collections;,sys.xml_schema_collections,success,7,,
332,Use CROSS APPLY to find the top 2 products for each subcategory by total sales.,"SELECT ps.Name AS Subcategory, ca.ProductID, ca.TotalSales FROM Production.ProductSubcategory ps CROSS APPLY (SELECT TOP 2 ProductID, SUM(LineTotal) AS TotalSales FROM Sales.SalesOrderDetail sod JOIN Production.Product p ON sod.ProductID = p.ProductID WHERE p.ProductSubcategoryID = ps.ProductSubcategoryID GROUP BY ProductID ORDER BY SUM(LineTotal) DESC) AS ca;","Production.Product, Production.ProductSubcategory, Sales.SalesOrderDetail","failed: ('42000', ""[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Ambiguous column name 'ProductID'. (209) (SQLExecDirectW)"")",,,
333,"Identify potential duplicate people in Person table based on first name, last name and the first 5 characters of their email address.","SELECT p.FirstName, p.LastName, LEFT(e.EmailAddress, 5) AS EmailPrefix, COUNT(*) FROM Person.Person p JOIN Person.EmailAddress e ON p.BusinessEntityID = e.BusinessEntityID GROUP BY p.FirstName, p.LastName, LEFT(e.EmailAddress, 5) HAVING COUNT(*) > 1;","Person.EmailAddress, Person.Person",success,279,,
334,Find the 'Pareto' products: The minimum set of products that make up 80% of the total revenue.,"WITH ProdRev AS (SELECT ProductID, SUM(LineTotal) AS Rev FROM Sales.SalesOrderDetail GROUP BY ProductID), RunningTotal AS (SELECT ProductID, Rev, SUM(Rev) OVER (ORDER BY Rev DESC) AS RT, SUM(Rev) OVER () AS Total FROM ProdRev) SELECT * FROM RunningTotal WHERE RT <= Total * 0.8;",Sales.SalesOrderDetail,success,63,,"[743, 747, 748, 749, 750, 751, 752, 753, 754, 758]"
335,Find the average number of days an employee stays in a department before moving.,"SELECT AVG(DATEDIFF(day, StartDate, ISNULL(EndDate, GETDATE()))) AS AvgDays FROM HumanResources.EmployeeDepartmentHistory;",HumanResources.EmployeeDepartmentHistory,success,,5975,
336,Identify vendors who have a lead time variance of more than 50% compared to their average.,"WITH VendorStats AS (SELECT BusinessEntityID, AVG(AverageLeadTime) AS AvgLT FROM Purchasing.ProductVendor GROUP BY BusinessEntityID) SELECT pv.* FROM Purchasing.ProductVendor pv JOIN VendorStats vs ON pv.BusinessEntityID = vs.BusinessEntityID WHERE ABS(pv.AverageLeadTime - vs.AvgLT) > (vs.AvgLT * 0.5);",Purchasing.ProductVendor,success,2,,"[[842, 1518], [843, 1518]]"
337,Calculate the 'Self-Join' hierarchy level for product assemblies in bill of materials.,"WITH RecursiveBOM AS (SELECT ComponentID, ProductAssemblyID, 1 AS Lvl FROM Production.BillOfMaterials WHERE ProductAssemblyID IS NULL UNION ALL SELECT b.ComponentID, b.ProductAssemblyID, r.Lvl + 1 FROM Production.BillOfMaterials b JOIN RecursiveBOM r ON b.ProductAssemblyID = r.ComponentID) SELECT * FROM RecursiveBOM;",Production.BillOfMaterials,success,1000,,"[[1, 805], [1, 805], [1, 805], [1, 805], [1, 805], [1, 805], [1, 805], [1, 805], [1, 805], [1, 805]]"
338,"Retrieve the details of the salesperson who has the highest ""Bonus per territory"" average.","SELECT TOP 1 BusinessEntityID, Bonus / (SELECT COUNT(*) FROM Sales.SalesTerritoryHistory WHERE BusinessEntityID = sp.BusinessEntityID) AS AvgBonus FROM Sales.SalesPerson sp ORDER BY AvgBonus DESC;","Sales.SalesPerson, Sales.SalesTerritoryHistory","failed: ('22012', '[22012] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Divide by zero error encountered. (8134) (SQLExecDirectW)')",,,
339,Find the most common birth month for employees.,"SELECT TOP 1 MONTH(BirthDate) AS BirthMonth, COUNT(*) FROM HumanResources.Employee GROUP BY MONTH(BirthDate) ORDER BY COUNT(*) DESC;",HumanResources.Employee,success,1,,
340,List sales orders that were shipped to a different country than the sales territory they belong to.,SELECT soh.SalesOrderID FROM Sales.SalesOrderHeader soh JOIN Person.Address a ON soh.ShipToAddressID = a.AddressID JOIN Person.StateProvince sp ON a.StateProvinceID = sp.StateProvinceID JOIN Sales.SalesTerritory st ON soh.TerritoryID = st.TerritoryID WHERE sp.CountryRegionCode <> st.CountryRegionCode;,"Person.Address, Person.StateProvince, Sales.SalesOrderHeader, Sales.SalesTerritory",success,0,,
341,Find the most profitable product subcategory in terms of list price minus standard cost.,"SELECT TOP 1 ps.Name, AVG(p.ListPrice - p.StandardCost) AS AvgProfit FROM Production.Product p JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID GROUP BY ps.Name ORDER BY AvgProfit DESC;","Production.Product, Production.ProductSubcategory",success,1,,
342,Show all work orders that took longer to complete than the scheduled duration.,"SELECT * FROM Production.WorkOrderRouting WHERE DATEDIFF(hour, ActualStartDate, ActualEndDate) > DATEDIFF(hour, ScheduledStartDate, ScheduledEndDate);",Production.WorkOrderRouting,success,1000,,"[[13, 747, 1, 10], [13, 747, 2, 20], [13, 747, 3, 30], [13, 747, 4, 40], [13, 747, 6, 50], [13, 747, 7, 60], [14, 748, 1, 10], [14, 748, 2, 20], [14, 748, 3, 30], [14, 748, 5, 45]]"
343,Calculate the 'Market Share' of each category based on the count of unique customers.,"WITH CatCust AS (SELECT pc.Name AS Category, COUNT(DISTINCT soh.CustomerID) AS CustCount FROM Sales.SalesOrderHeader soh JOIN Sales.SalesOrderDetail sod ON soh.SalesOrderID = sod.SalesOrderID JOIN Production.Product p ON sod.ProductID = p.ProductID JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID GROUP BY pc.Name) SELECT *, CustCount * 100.0 / (SELECT SUM(CustCount) FROM CatCust) AS SharePct FROM CatCust;","Production.Product, Production.ProductCategory, Production.ProductSubcategory, Sales.SalesOrderDetail, Sales.SalesOrderHeader",success,4,,
344,Find all product models that do not have any associated Illustrations.,SELECT pm.Name FROM Production.ProductModel pm LEFT JOIN Production.ProductModelIllustration pmi ON pm.ProductModelID = pmi.ProductModelID WHERE pmi.IllustrationID IS NULL;,"Production.ProductModel, Production.ProductModelIllustration",success,123,,
345,Group sales persons by their commission Pct and find the average sales YTD for each group.,"SELECT CommissionPct, AVG(SalesYTD) FROM Sales.SalesPerson GROUP BY CommissionPct;",Sales.SalesPerson,success,8,,
346,Identify orders where the customer used a credit card that expires in the same year as the order.,"SELECT soh.SalesOrderID, cc.ExpYear, YEAR(soh.OrderDate) FROM Sales.SalesOrderHeader soh JOIN Sales.CreditCard cc ON soh.CreditCardID = cc.CreditCardID WHERE cc.ExpYear = YEAR(soh.OrderDate);","Sales.CreditCard, Sales.SalesOrderHeader",success,0,,
347,"Use COALESCE to show the ship date, or 'Not Shipped' if it is NULL.","SELECT SalesOrderID, COALESCE(CAST(ShipDate AS nvarchar(20)), 'Not Shipped') FROM Sales.SalesOrderHeader;",Sales.SalesOrderHeader,success,1000,,"[43659, 43660, 43661, 43662, 43663, 43664, 43665, 43666, 43667, 43668]"
348,Calculate the 'Day-over-Day' percentage change in total sales for the last 30 days of data.,"WITH DailySales AS (SELECT CAST(OrderDate AS date) AS SalesDate, SUM(TotalDue) AS Total FROM Sales.SalesOrderHeader GROUP BY CAST(OrderDate AS date)) SELECT SalesDate, Total, (Total - LAG(Total) OVER (ORDER BY SalesDate)) / LAG(Total) OVER (ORDER BY SalesDate) * 100 AS DoD_Change FROM DailySales;",Sales.SalesOrderHeader,success,1000,,
349,Find the longest and shortest product description for the 'en' culture.,"SELECT TOP 1 'Longest' AS Type, Description FROM Production.ProductDescription pd JOIN Production.ProductModelProductDescriptionCulture pmpd ON pd.ProductDescriptionID = pmpd.ProductDescriptionID WHERE CultureID = 'en' ORDER BY LEN(Description) DESC UNION ALL SELECT TOP 1 'Shortest', Description FROM Production.ProductDescription pd JOIN Production.ProductModelProductDescriptionCulture pmpd ON pd.ProductDescriptionID = pmpd.ProductDescriptionID WHERE CultureID = 'en' ORDER BY LEN(Description) ASC;","Production.ProductDescription, Production.ProductModelProductDescriptionCulture","failed: ('42000', ""[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near the keyword 'UNION'. (156) (SQLExecDirectW)"")",,,
350,Identify sales persons whose sales last year was higher than the sales last year of their territory.,"SELECT sp.BusinessEntityID, sp.SalesLastYear AS PersonLastYear, st.SalesLastYear AS TerritoryLastYear FROM Sales.SalesPerson sp JOIN Sales.SalesTerritory st ON sp.TerritoryID = st.TerritoryID WHERE sp.SalesLastYear > st.SalesLastYear;","Sales.SalesPerson, Sales.SalesTerritory",success,0,,
351,Retrieve the 51st to 60th most expensive products.,"SELECT Name, ListPrice FROM Production.Product ORDER BY ListPrice DESC OFFSET 50 ROWS FETCH NEXT 10 ROWS ONLY;",Production.Product,success,10,,
352,Find all employees who have 'Senior' in their job title but are not 'OrganizationLevel' 1 or 2.,"SELECT * FROM HumanResources.Employee WHERE JobTitle LIKE '%Senior%' AND OrganizationLevel NOT IN (1, 2);",HumanResources.Employee,"failed: ('ODBC SQL type -151 is not yet supported.  column-index=3  type=-151', 'HY106')",,,
353,Extract all skills listed in the job candidate resumes.,"WITH XMLNAMESPACES ('http://schemas.microsoft.com/sqlserver/2004/07/adventure-works/Resume' AS res) SELECT JobCandidateID, T.c.value('.', 'nvarchar(max)') AS Skill FROM HumanResources.JobCandidate CROSS APPLY Resume.nodes('//res:Skill') AS T(c);",HumanResources.JobCandidate,"failed: ('42000', ""[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]XQuery [HumanResources.JobCandidate.Resume.value()]: Cannot implicitly atomize or apply 'fn:data()' to complex content elements...",,,
354,"Find the total weight of all products included in a specific sales order (e.g., ID 43659).",SELECT SUM(p.Weight * sod.OrderQty) FROM Sales.SalesOrderDetail sod JOIN Production.Product p ON sod.ProductID = p.ProductID WHERE sod.SalesOrderID = 43659;,"Production.Product, Sales.SalesOrderDetail",success,,210.38,
355,List the sales persons who have never sold a product from the 'Clothing' category.,SELECT BusinessEntityID FROM Sales.SalesPerson WHERE BusinessEntityID NOT IN (SELECT soh.SalesPersonID FROM Sales.SalesOrderHeader soh JOIN Sales.SalesOrderDetail sod ON soh.SalesOrderID = sod.SalesOrderID JOIN Production.Product p ON sod.ProductID = p.ProductID JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID WHERE pc.Name = 'Clothing');,"Production.Product, Production.ProductCategory, Production.ProductSubcategory, Sales.SalesOrderDetail, Sales.SalesOrderHeader, Sales.SalesPerson",success,0,,
356,Calculate the weighted average list price of products sold (line total / quantity).,SELECT SUM(LineTotal) / SUM(OrderQty) AS WeightedAvgPrice FROM Sales.SalesOrderDetail;,Sales.SalesOrderDetail,success,,399.566342,
357,Identify gaps in the work order ID sequence.,"WITH WSeq AS (SELECT WorkOrderID, LEAD(WorkOrderID) OVER (ORDER BY WorkOrderID) AS NextID FROM Production.WorkOrder) SELECT WorkOrderID + 1, NextID - 1 FROM WSeq WHERE NextID - WorkOrderID > 1;",Production.WorkOrder,success,0,,
358,Use TRY_CAST to attempt to convert a column that might have messy data.,SELECT TRY_CAST(ProductNumber AS int) FROM Production.Product;,Production.Product,success,504,,
359,Find the average number of distinct products per sales order.,"SELECT AVG(CAST(ProdCount AS float)) FROM (SELECT SalesOrderID, COUNT(DISTINCT ProductID) AS ProdCount FROM Sales.SalesOrderDetail GROUP BY SalesOrderID) AS t;",Sales.SalesOrderDetail,success,1,,
360,List all people whose first name sounds like John using SOUNDEX.,"SELECT FirstName, LastName FROM Person.Person WHERE SOUNDEX(FirstName) = SOUNDEX('John');",Person.Person,success,448,,
361,Calculate the total quantity of 'Scrapped' items per month in 2013.,"SELECT MONTH(EndDate) AS Mo, SUM(ScrappedQty) FROM Production.WorkOrder WHERE YEAR(EndDate) = 2013 GROUP BY MONTH(EndDate);",Production.WorkOrder,success,12,,
362,Show the running count of orders placed by each customer.,"SELECT CustomerID, SalesOrderID, ROW_NUMBER() OVER (PARTITION BY CustomerID ORDER BY OrderDate) AS OrderSequenceNumber FROM Sales.SalesOrderHeader;",Sales.SalesOrderHeader,success,1000,,"[[11000, 43793], [11000, 51522], [11000, 57418], [11001, 43767], [11001, 51493], [11001, 72773], [11002, 43736], [11002, 51238], [11002, 53237], [11003, 43701]]"
363,Find the product that has the highest 'Price to Weight' ratio.,"SELECT TOP 1 Name, ListPrice / Weight AS Ratio FROM Production.Product WHERE Weight > 0 ORDER BY Ratio DESC;",Production.Product,success,1,,
364,"Label orders as 'Local' if TerritoryID is 1, and 'Export' otherwise.","SELECT SalesOrderID, IIF(TerritoryID = 1, 'Local', 'Export') AS OrderType FROM Sales.SalesOrderHeader;",Sales.SalesOrderHeader,success,1000,,"[43659, 43660, 43661, 43662, 43663, 43664, 43665, 43666, 43667, 43668]"
365,Identify customers who have used more than 3 different credit cards.,SELECT BusinessEntityID FROM Sales.PersonCreditCard GROUP BY BusinessEntityID HAVING COUNT(CreditCardID) > 3;,Sales.PersonCreditCard,success,0,,
366,Find the sales person with the highest 'Conversion' (orders per month they were active).,"WITH ActiveMonths AS (SELECT SalesPersonID, DATEDIFF(month, MIN(OrderDate), MAX(OrderDate)) + 1 AS Months FROM Sales.SalesOrderHeader WHERE SalesPersonID IS NOT NULL GROUP BY SalesPersonID) SELECT am.SalesPersonID, COUNT(soh.SalesOrderID) / CAST(am.Months AS float) AS Conv FROM Sales.SalesOrderHeader soh JOIN ActiveMonths am ON soh.SalesPersonID = am.SalesPersonID GROUP BY am.SalesPersonID, am.Months ORDER BY Conv DESC;",Sales.SalesOrderHeader,success,17,,"[274, 275, 276, 277, 278, 279, 280, 281, 282, 283]"
367,"List all products that were ever discontinued but later replaced (same product model ID, newer sell start date).","SELECT p1.Name AS Discontinued, p2.Name AS Replacement FROM Production.Product p1 JOIN Production.Product p2 ON p1.ProductModelID = p2.ProductModelID WHERE p1.DiscontinuedDate IS NOT NULL AND p2.SellStartDate > p1.DiscontinuedDate;",Production.Product,success,0,,
368,Calculate the 'Geometric Mean' of list prices.,SELECT EXP(AVG(LOG(ListPrice))) FROM Production.Product WHERE ListPrice > 0;,Production.Product,success,,279.40594305154207,
369,Identify addresses that are registered as both 'Home' and 'Shipping' address type.,"SELECT BusinessEntityID, AddressID FROM Person.BusinessEntityAddress GROUP BY BusinessEntityID, AddressID HAVING COUNT(AddressTypeID) > 1;",Person.BusinessEntityAddress,success,0,,
370,"Use CHOOSE to select a string based on the priority (1, 2, 3) of an item.","SELECT SalesOrderID, Status, CHOOSE(Status, 'In Process', 'Approved', 'Backordered', 'Rejected', 'Shipped', 'Cancelled') FROM Sales.SalesOrderHeader;",Sales.SalesOrderHeader,success,1000,,"[43659, 43660, 43661, 43662, 43663, 43664, 43665, 43666, 43667, 43668]"
371,Find all products that are 'Parent' components in at least 5 different bill of materials.,SELECT ProductAssemblyID FROM Production.BillOfMaterials GROUP BY ProductAssemblyID HAVING COUNT(ComponentID) >= 5;,Production.BillOfMaterials,success,204,,"[null, 517, 518, 522, 680, 706, 717, 718, 719, 720]"
372,Rank employees by the number of days they've been in their current organization level.,"SELECT BusinessEntityID, OrganizationLevel, DATEDIFF(day, ModifiedDate, GETDATE()) AS DaysInLevel, RANK() OVER (PARTITION BY OrganizationLevel ORDER BY ModifiedDate) AS Rnk FROM HumanResources.Employee;",HumanResources.Employee,success,290,,"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
373,Use STRING_AGG to list all unique colors available in each category.,"SELECT pc.Name AS Category, STRING_AGG(DISTINCT p.Color, ', ') AS Colors FROM Production.Product p JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID GROUP BY pc.Name;","Production.Product, Production.ProductCategory, Production.ProductSubcategory","failed: ('42000', ""[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Incorrect syntax near ','. (102) (SQLExecDirectW)"")",,,
374,Find the sales person whose average order value is most consistent (lowest standard deviation).,"SELECT TOP 1 SalesPersonID, STDEV(TotalDue) AS StdDev FROM Sales.SalesOrderHeader WHERE SalesPersonID IS NOT NULL GROUP BY SalesPersonID ORDER BY StdDev ASC;",Sales.SalesOrderHeader,success,1,,[286]
375,Calculate the total tax amount for each country region.,"SELECT cr.Name, SUM(soh.TaxAmt) FROM Sales.SalesOrderHeader soh JOIN Person.Address a ON soh.ShipToAddressID = a.AddressID JOIN Person.StateProvince sp ON a.StateProvinceID = sp.StateProvinceID JOIN Person.CountryRegion cr ON sp.CountryRegionCode = cr.CountryRegionCode GROUP BY cr.Name;","Person.Address, Person.CountryRegion, Person.StateProvince, Sales.SalesOrderHeader",success,6,,
376,Retrieve all job candidates who have 'Microsoft' mentioned in their resume.,"WITH XMLNAMESPACES ('http://schemas.microsoft.com/sqlserver/2004/07/adventure-works/Resume' AS res) SELECT JobCandidateID FROM HumanResources.JobCandidate WHERE Resume.exist('//res:Employer[contains(., ""Microsoft"")]') = 1;",HumanResources.JobCandidate,"failed: ('42000', ""[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]XQuery [HumanResources.JobCandidate.Resume.exist()]: Cannot implicitly atomize or apply 'fn:data()' to complex content elements...",,,
377,Identify potential 'Gap' periods where no sales were made for more than 48 hours.,"WITH Lagged AS (SELECT OrderDate, LAG(OrderDate) OVER (ORDER BY OrderDate) AS PrevDate FROM Sales.SalesOrderHeader) SELECT OrderDate, PrevDate, DATEDIFF(hour, PrevDate, OrderDate) FROM Lagged WHERE DATEDIFF(hour, PrevDate, OrderDate) > 48;",Sales.SalesOrderHeader,success,0,,
378,Calculate the profit margin ((ListPrice - StandardCost) / ListPrice) for each product.,"SELECT Name, (ListPrice - StandardCost) / NULLIF(ListPrice, 0) AS Margin FROM Production.Product;",Production.Product,success,504,,
379,Find all products that have had more than 3 price changes in list price history.,SELECT ProductID FROM Production.ProductListPriceHistory GROUP BY ProductID HAVING COUNT(*) > 3;,Production.ProductListPriceHistory,success,0,,
380,Use a common table expression to find the top 5 cities by total number of employees.,"WITH CityEmp AS (SELECT a.City, COUNT(e.BusinessEntityID) AS EmpCount FROM HumanResources.Employee e JOIN Person.BusinessEntityAddress bea ON e.BusinessEntityID = bea.BusinessEntityID JOIN Person.Address a ON bea.AddressID = a.AddressID GROUP BY a.City) SELECT TOP 5 * FROM CityEmp ORDER BY EmpCount DESC;","HumanResources.Employee, Person.Address, Person.BusinessEntityAddress",success,5,,
381,Calculate the average rate of pay for employees in each shift.,"SELECT s.Name, AVG(eph.Rate) FROM HumanResources.Shift s JOIN HumanResources.EmployeeDepartmentHistory edh ON s.ShiftID = edh.ShiftID JOIN HumanResources.EmployeePayHistory eph ON edh.BusinessEntityID = eph.BusinessEntityID GROUP BY s.Name;","HumanResources.EmployeeDepartmentHistory, HumanResources.EmployeePayHistory, HumanResources.Shift",success,3,,
382,Find the product that has been 'Scrapped' for the most unique reasons.,"SELECT TOP 1 ProductID, COUNT(DISTINCT ScrapReasonID) AS ReasonCount FROM Production.WorkOrder WHERE ScrapReasonID IS NOT NULL GROUP BY ProductID ORDER BY ReasonCount DESC;",Production.WorkOrder,success,1,,[316]
383,Identify sales orders that were modified after they were shipped.,SELECT SalesOrderID FROM Sales.SalesOrderHeader WHERE ModifiedDate > ShipDate;,Sales.SalesOrderHeader,success,0,,
384,Calculate the 'Year-to-Date' cumulative sales for each month in the database.,"SELECT YEAR(OrderDate) AS Yr, MONTH(OrderDate) AS Mo, SUM(TotalDue) AS Monthly, SUM(SUM(TotalDue)) OVER (PARTITION BY YEAR(OrderDate) ORDER BY MONTH(OrderDate)) AS YTD FROM Sales.SalesOrderHeader GROUP BY YEAR(OrderDate), MONTH(OrderDate);",Sales.SalesOrderHeader,success,38,,
385,Find all persons whose last name has more than 10 characters and starts with 'V'.,"SELECT FirstName, LastName FROM Person.Person WHERE LEN(LastName) > 10 AND LastName LIKE 'V%';",Person.Person,success,5,,
386,Use CROSS JOIN to generate a calendar of all months between 2011 and 2014.,"WITH Years AS (SELECT 2011 AS Y UNION SELECT 2012 UNION SELECT 2013 UNION SELECT 2014), Months AS (SELECT 1 AS M UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10 UNION SELECT 11 UNION SELECT 12) SELECT Y, M FROM Years CROSS JOIN Months;",,success,48,,
387,Identify products where the standard cost in the product table doesn't match the most recent entry in product cost history.,"SELECT p.ProductID, p.StandardCost, pch.StandardCost AS HistoryCost FROM Production.Product p JOIN (SELECT ProductID, StandardCost, ROW_NUMBER() OVER (PARTITION BY ProductID ORDER BY StartDate DESC) AS rnk FROM Production.ProductCostHistory) AS pch ON p.ProductID = pch.ProductID WHERE pch.rnk = 1 AND p.StandardCost <> pch.StandardCost;","Production.Product, Production.ProductCostHistory",success,0,,
388,Find the 'Top 3' subcategories by revenue for the 'Europe' territory group.,"SELECT TOP 3 ps.Name, SUM(sod.LineTotal) AS Rev FROM Sales.SalesOrderDetail sod JOIN Production.Product p ON sod.ProductID = p.ProductID JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Sales.SalesOrderHeader soh ON sod.SalesOrderID = soh.SalesOrderID JOIN Sales.SalesTerritory st ON soh.TerritoryID = st.TerritoryID WHERE st.[Group] = 'Europe' GROUP BY ps.Name ORDER BY Rev DESC;","Production.Product, Production.ProductSubcategory, Sales.SalesOrderDetail, Sales.SalesOrderHeader, Sales.SalesTerritory",success,3,,
389,Use PATINDEX to find products with a number between 50 and 59 in their Name.,"SELECT Name FROM Production.Product WHERE PATINDEX('%5[0-9]%', Name) > 0;",Production.Product,success,88,,
390,Calculate the total number of hours worked by all resources in work order routing.,SELECT SUM(ActualResourceHrs) FROM Production.WorkOrderRouting;,Production.WorkOrderRouting,success,,228962.2000,
391,Identify potential orphan addresses that are not linked to any business entity.,SELECT AddressID FROM Person.Address EXCEPT SELECT AddressID FROM Person.BusinessEntityAddress;,"Person.Address, Person.BusinessEntityAddress",success,0,,
392,Retrieve the 'Instructions' XML for products that have a 'MachineHours' value greater than 5.,"WITH XMLNAMESPACES ('http://schemas.microsoft.com/sqlserver/2004/07/adventure-works/ProductModelManuInstructions' AS mi) SELECT Name FROM Production.ProductModel WHERE Instructions.value('(/mi:root/mi:Location/@MachineHours)[1]', 'decimal') > 5;",Production.ProductModel,success,0,,
393,Find the average number of product photos per product.,"SELECT AVG(CAST(PhotoCount AS float)) FROM (SELECT ProductID, COUNT(ProductPhotoID) AS PhotoCount FROM Production.ProductProductPhoto GROUP BY ProductID) AS t;",Production.ProductProductPhoto,success,1,,
394,Identify sales orders where the total due is not equal to sub total + tax amount + freight.,"SELECT SalesOrderID, TotalDue, (SubTotal + TaxAmt + Freight) AS Calculated FROM Sales.SalesOrderHeader WHERE ABS(TotalDue - (SubTotal + TaxAmt + Freight)) > 0.01;",Sales.SalesOrderHeader,success,0,,
395,Use ROW_NUMBER to delete duplicate rows from a table.,"WITH CTE AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY [UniqueCols] ORDER BY [SortCol]) AS rnk FROM [Table]) DELETE FROM CTE WHERE rnk > 1;",,"failed: ('42S02', ""[42S02] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid object name 'Table'. (208) (SQLExecDirectW)"")",,,
396,Find the most active 'Day of the Week' for orders.,"SELECT TOP 1 DATENAME(weekday, OrderDate) AS DayName, COUNT(*) FROM Sales.SalesOrderHeader GROUP BY DATENAME(weekday, OrderDate) ORDER BY COUNT(*) DESC;",Sales.SalesOrderHeader,success,1,,
397,Identify all products that have an associated 'Illustration' with a specific diagram type.,SELECT p.Name FROM Production.Product p JOIN Production.ProductModelIllustration pmi ON p.ProductModelID = pmi.ProductModelID JOIN Production.Illustration i ON pmi.IllustrationID = i.IllustrationID WHERE i.Diagram.exist('//*:Shape') = 1;,"Production.Illustration, Production.Product, Production.ProductModelIllustration",success,0,,
398,Calculate the 'Correlation' between list price and standard cost.,SELECT (AVG(ListPrice * StandardCost) - AVG(ListPrice) * AVG(StandardCost)) / (STDEVP(ListPrice) * STDEVP(StandardCost)) AS Correlation FROM Production.Product;,Production.Product,success,,0.9974160615695156,
399,List the sales persons who have achieved their sales quota for every year they have a record in sales person quota history.,"SELECT BusinessEntityID FROM Sales.SalesPersonQuotaHistory GROUP BY BusinessEntityID HAVING MIN(IIF(SalesQuota > 0, 1, 0)) = 1;",Sales.SalesPersonQuotaHistory,success,17,,"[274, 275, 276, 277, 278, 279, 280, 281, 282, 283]"
400,Find the top 5 'Most Shared' first names.,"SELECT TOP 5 FirstName, COUNT(*) AS Frequency FROM Person.Person GROUP BY FirstName ORDER BY Frequency DESC;",Person.Person,success,5,,
