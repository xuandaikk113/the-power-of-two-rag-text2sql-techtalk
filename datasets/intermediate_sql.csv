#,Question,Actual Query,involved_tables,executed,record_count,expected_answer,primary_keys
201,Find the total sales amount (sub total) for each sales territory name.,"SELECT st.Name, SUM(soh.SubTotal) AS TotalSales FROM Sales.SalesOrderHeader soh JOIN Sales.SalesTerritory st ON soh.TerritoryID = st.TerritoryID GROUP BY st.Name;","Sales.SalesOrderHeader, Sales.SalesTerritory",success,10,,
202,"List territories that have total sales exceeding $10,000,000.","SELECT st.Name, SUM(soh.SubTotal) AS TotalSales FROM Sales.SalesOrderHeader soh JOIN Sales.SalesTerritory st ON soh.TerritoryID = st.TerritoryID GROUP BY st.Name HAVING SUM(soh.SubTotal) > 10000000;","Sales.SalesOrderHeader, Sales.SalesTerritory",success,4,,
203,Rank employees by their vacation hours within each job title.,"SELECT JobTitle, BusinessEntityID, VacationHours, RANK() OVER(PARTITION BY JobTitle ORDER BY VacationHours DESC) AS RankInsideTitle FROM HumanResources.Employee;",HumanResources.Employee,success,290,,"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
204,Find all employees whose pay rate is above the average pay rate of the company.,"SELECT BusinessEntityID, Rate FROM HumanResources.EmployeePayHistory WHERE Rate > (SELECT AVG(Rate) FROM HumanResources.EmployeePayHistory);",HumanResources.EmployeePayHistory,success,103,,"[1, 2, 3, 4, 4, 5, 6, 7, 8, 9]"
205,"Show the total number of orders placed by each customer, but only for customers with more than 20 orders.","SELECT CustomerID, COUNT(*) AS OrderCount FROM Sales.SalesOrderHeader GROUP BY CustomerID HAVING COUNT(*) > 20;",Sales.SalesOrderHeader,success,14,,"[11091, 11176, 11185, 11200, 11223, 11262, 11276, 11277, 11287, 11300]"
206,List product names and their categories for products that have never been ordered.,SELECT p.Name FROM Production.Product p WHERE NOT EXISTS (SELECT 1 FROM Sales.SalesOrderDetail sod WHERE sod.ProductID = p.ProductID);,"Production.Product, Sales.SalesOrderDetail",success,238,,
207,Calculate the running total of sales (sub total) ordered by order date.,"SELECT SalesOrderID, OrderDate, SubTotal, SUM(SubTotal) OVER(ORDER BY OrderDate, SalesOrderID) AS RunningTotal FROM Sales.SalesOrderHeader;",Sales.SalesOrderHeader,success,1000,,"[43659, 43660, 43661, 43662, 43663, 43664, 43665, 43666, 43667, 43668]"
208,Get the name of the department that has the most employees.,"SELECT TOP 1 d.Name, COUNT(*) AS EmpCount FROM HumanResources.Department d JOIN HumanResources.EmployeeDepartmentHistory edh ON d.DepartmentID = edh.DepartmentID GROUP BY d.Name ORDER BY EmpCount DESC;","HumanResources.Department, HumanResources.EmployeeDepartmentHistory",success,1,,
209,Use a CTE to list employees hired in the last 5 years of the dataset's range.,"WITH RecentHires AS (SELECT * FROM HumanResources.Employee WHERE HireDate >= DATEADD(year, -5, (SELECT MAX(HireDate) FROM HumanResources.Employee))) SELECT * FROM RecentHires;",HumanResources.Employee,"failed: ('ODBC SQL type -151 is not yet supported.  column-index=3  type=-151', 'HY106')",,,
210,Find the difference between an employee's rate and the average rate of their department.,"SELECT e.BusinessEntityID, d.Name AS Dept, eph.Rate, AVG(eph.Rate) OVER(PARTITION BY d.DepartmentID) AS DeptAvg, eph.Rate - AVG(eph.Rate) OVER(PARTITION BY d.DepartmentID) AS Diff FROM HumanResources.Employee e JOIN HumanResources.EmployeePayHistory eph ON e.BusinessEntityID = eph.BusinessEntityID JOIN HumanResources.EmployeeDepartmentHistory edh ON e.BusinessEntityID = edh.BusinessEntityID JOIN HumanResources.Department d ON edh.DepartmentID = d.DepartmentID WHERE edh.EndDate IS NULL;","HumanResources.Department, HumanResources.Employee, HumanResources.EmployeeDepartmentHistory, HumanResources.EmployeePayHistory",success,316,,"[1, 2, 3, 4, 4, 4, 5, 6, 7, 8]"
211,List the top 3 most expensive products in each subcategory.,"SELECT * FROM (SELECT Name, ProductSubcategoryID, ListPrice, ROW_NUMBER() OVER(PARTITION BY ProductSubcategoryID ORDER BY ListPrice DESC) AS PriceRank FROM Production.Product) AS RankedProducts WHERE PriceRank <= 3;",Production.Product,success,93,,"[null, null, null, 1, 1, 1, 10, 10, 10, 11]"
212,Show all sales orders where the tax amount is more than 10% of the sub total.,"SELECT SalesOrderID, SubTotal, TaxAmt FROM Sales.SalesOrderHeader WHERE TaxAmt > (SubTotal * 0.1);",Sales.SalesOrderHeader,success,178,,"[46323, 46327, 46330, 46332, 46334, 46342, 46345, 46346, 46348, 46352]"
213,Identify customers who have placed orders in every year available in the database.,SELECT CustomerID FROM Sales.SalesOrderHeader GROUP BY CustomerID HAVING COUNT(DISTINCT YEAR(OrderDate)) = (SELECT COUNT(DISTINCT YEAR(OrderDate)) FROM Sales.SalesOrderHeader);,Sales.SalesOrderHeader,success,100,,"[29486, 29487, 29489, 29494, 29497, 29498, 29508, 29509, 29511, 29521]"
214,"Combine the first name and last name into a single column ""FullName"" for all employees.","SELECT p.FirstName + ' ' + ISNULL(p.MiddleName + ' ', '') + p.LastName AS FullName FROM Person.Person p JOIN HumanResources.Employee e ON p.BusinessEntityID = e.BusinessEntityID;","HumanResources.Employee, Person.Person",success,290,,
215,Find products that have been sold in more than 10 different sales orders.,"SELECT ProductID, COUNT(DISTINCT SalesOrderID) AS OrderCount FROM Sales.SalesOrderDetail GROUP BY ProductID HAVING COUNT(DISTINCT SalesOrderID) > 10;",Sales.SalesOrderDetail,success,260,,"[707, 708, 709, 710, 711, 712, 713, 714, 715, 716]"
216,List the average list price of products for each category name.,"SELECT c.Name, AVG(p.ListPrice) AS AvgPrice FROM Production.Product p JOIN Production.ProductSubcategory s ON p.ProductSubcategoryID = s.ProductSubcategoryID JOIN Production.ProductCategory c ON s.ProductCategoryID = c.ProductCategoryID GROUP BY c.Name;","Production.Product, Production.ProductCategory, Production.ProductSubcategory",success,4,,
217,"Categorize employees based on their sick leave hours: 'High' (>60), 'Medium' (30-60), 'Low' (<30).","SELECT BusinessEntityID, SickLeaveHours, CASE WHEN SickLeaveHours > 60 THEN 'High' WHEN SickLeaveHours BETWEEN 30 AND 60 THEN 'Medium' ELSE 'Low' END AS LeaveCategory FROM HumanResources.Employee;",HumanResources.Employee,success,290,,"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
218,Find all sales persons who achieved more than their sales quota in the current year.,"SELECT BusinessEntityID, SalesYTD, SalesQuota FROM Sales.SalesPerson WHERE SalesYTD > SalesQuota;",Sales.SalesPerson,success,14,,"[275, 276, 277, 278, 279, 280, 281, 282, 283, 284]"
219,Retrieve the details of the most recent order for each customer.,"SELECT * FROM (SELECT SalesOrderID, CustomerID, OrderDate, ROW_NUMBER() OVER(PARTITION BY CustomerID ORDER BY OrderDate DESC) AS LatestOrder FROM Sales.SalesOrderHeader) AS t WHERE LatestOrder = 1;",Sales.SalesOrderHeader,success,1000,,"[[51193, 11020], [51207, 11338], [51224, 11345], [51230, 11292], [51262, 11340], [51264, 11282], [51275, 11265], [51276, 11136], [51277, 11278], [51288, 11335]]"
220,List vendors who provide more than 5 different products.,"SELECT BusinessEntityID, COUNT(ProductID) AS ProductCount FROM Purchasing.ProductVendor GROUP BY BusinessEntityID HAVING COUNT(ProductID) > 5;",Purchasing.ProductVendor,success,23,,"[1492, 1496, 1518, 1534, 1536, 1540, 1546, 1554, 1562, 1568]"
221,Find the month with the highest total sales across all years.,"SELECT TOP 1 MONTH(OrderDate) AS SalesMonth, SUM(TotalDue) AS MonthlyTotal FROM Sales.SalesOrderHeader GROUP BY MONTH(OrderDate) ORDER BY MonthlyTotal DESC;",Sales.SalesOrderHeader,success,1,,
222,Show products that have been sold both in red and black colors.,SELECT Name FROM Production.Product WHERE Color = 'Red' INTERSECT SELECT Name FROM Production.Product WHERE Color = 'Black';,Production.Product,success,0,,
223,List employees who have changed departments at least once.,SELECT BusinessEntityID FROM HumanResources.EmployeeDepartmentHistory GROUP BY BusinessEntityID HAVING COUNT(DepartmentID) > 1;,HumanResources.EmployeeDepartmentHistory,success,5,,"[4, 16, 224, 234, 250]"
224,Find the total quantity sold for each product category.,"SELECT c.Name, SUM(sod.OrderQty) AS TotalQty FROM Sales.SalesOrderDetail sod JOIN Production.Product p ON sod.ProductID = p.ProductID JOIN Production.ProductSubcategory s ON p.ProductSubcategoryID = s.ProductSubcategoryID JOIN Production.ProductCategory c ON s.ProductCategoryID = c.ProductCategoryID GROUP BY c.Name;","Production.Product, Production.ProductCategory, Production.ProductSubcategory, Sales.SalesOrderDetail",success,4,,
225,Use a CTE to calculate the total sales per year.,"WITH YearlySales AS (SELECT YEAR(OrderDate) AS SaleYear, TotalDue FROM Sales.SalesOrderHeader) SELECT SaleYear, SUM(TotalDue) AS AnnualTotal FROM YearlySales GROUP BY SaleYear;",Sales.SalesOrderHeader,success,4,,
226,Find products where the safety stock level is less than the current inventory in all locations combined.,"SELECT p.Name, p.SafetyStockLevel, inv.TotalStock FROM Production.Product p JOIN (SELECT ProductID, SUM(Quantity) AS TotalStock FROM Production.ProductInventory GROUP BY ProductID) AS inv ON p.ProductID = inv.ProductID WHERE p.SafetyStockLevel < inv.TotalStock;","Production.Product, Production.ProductInventory",success,363,,
227,List sales persons and the percentage of total territory sales they contributed.,"SELECT sp.BusinessEntityID, st.Name AS Territory, sp.SalesYTD, (sp.SalesYTD / st.SalesYTD) * 100 AS ContributionPct FROM Sales.SalesPerson sp JOIN Sales.SalesTerritory st ON sp.TerritoryID = st.TerritoryID WHERE st.SalesYTD > 0;","Sales.SalesPerson, Sales.SalesTerritory",success,14,,"[275, 276, 277, 278, 279, 280, 281, 282, 283, 284]"
228,Find orders where the ship date was more than 7 days after the order date.,"SELECT SalesOrderID, OrderDate, ShipDate FROM Sales.SalesOrderHeader WHERE DATEDIFF(day, OrderDate, ShipDate) > 7;",Sales.SalesOrderHeader,success,9,,"[65089, 65090, 67202, 67203, 67204, 69309, 69310, 71691, 71692]"
229,Count how many people have more than one email address.,"SELECT BusinessEntityID, COUNT(*) AS EmailCount FROM Person.EmailAddress GROUP BY BusinessEntityID HAVING COUNT(*) > 1;",Person.EmailAddress,success,0,,
230,"Show the product name and its total sales, including products with zero sales.","SELECT p.Name, ISNULL(SUM(sod.LineTotal), 0) AS TotalSales FROM Production.Product p LEFT JOIN Sales.SalesOrderDetail sod ON p.ProductID = sod.ProductID GROUP BY p.Name;","Production.Product, Sales.SalesOrderDetail",success,504,,
231,Find the job title with the highest average vacation hours.,"SELECT TOP 1 JobTitle, AVG(VacationHours) AS AvgVacation FROM HumanResources.Employee GROUP BY JobTitle ORDER BY AvgVacation DESC;",HumanResources.Employee,success,1,,
232,Retrieve all addresses that are used by more than one business entity.,"SELECT AddressID, COUNT(BusinessEntityID) FROM Person.BusinessEntityAddress GROUP BY AddressID HAVING COUNT(BusinessEntityID) > 1;",Person.BusinessEntityAddress,success,0,,
233,List sales orders that include at least one product from the Bikes category.,SELECT DISTINCT sod.SalesOrderID FROM Sales.SalesOrderDetail sod JOIN Production.Product p ON sod.ProductID = p.ProductID JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID WHERE pc.Name = 'Bikes';,"Production.Product, Production.ProductCategory, Production.ProductSubcategory, Sales.SalesOrderDetail",success,1000,,"[43661, 43667, 43707, 43710, 43724, 43744, 43770, 43787, 43807, 43833]"
234,Determine the age of each employee at the time they were hired.,"SELECT BusinessEntityID, DATEDIFF(year, BirthDate, HireDate) AS HireAge FROM HumanResources.Employee;",HumanResources.Employee,success,290,,"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
235,Find customers who haven't placed an order in the last 12 months of the record history.,"DECLARE @MaxDate datetime = (SELECT MAX(OrderDate) FROM Sales.SalesOrderHeader); SELECT CustomerID FROM Sales.Customer WHERE CustomerID NOT IN (SELECT CustomerID FROM Sales.SalesOrderHeader WHERE OrderDate >= DATEADD(month, -12, @MaxDate));","Sales.Customer, Sales.SalesOrderHeader",success,1000,,"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
236,Calculate the average discount percentage given for each product category.,"SELECT pc.Name, AVG(so.DiscountPct) AS AvgDiscount FROM Sales.SalesOrderDetail sod JOIN Sales.SpecialOffer so ON sod.SpecialOfferID = so.SpecialOfferID JOIN Production.Product p ON sod.ProductID = p.ProductID JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID GROUP BY pc.Name;","Production.Product, Production.ProductCategory, Production.ProductSubcategory, Sales.SalesOrderDetail, Sales.SpecialOffer",success,4,,
237,List all products that have been sold in every territory.,SELECT ProductID FROM Sales.SalesOrderDetail sod JOIN Sales.SalesOrderHeader soh ON sod.SalesOrderID = soh.SalesOrderID GROUP BY ProductID HAVING COUNT(DISTINCT soh.TerritoryID) = (SELECT COUNT(*) FROM Sales.SalesTerritory);,"Sales.SalesOrderDetail, Sales.SalesOrderHeader, Sales.SalesTerritory",success,164,,"[707, 708, 711, 712, 714, 715, 716, 739, 742, 743]"
238,"Show the total number of work orders for each product, sorted by quantity of scrapped items.","SELECT ProductID, COUNT(*) AS WorkOrderCount, SUM(ScrappedQty) AS TotalScrapped FROM Production.WorkOrder GROUP BY ProductID ORDER BY TotalScrapped DESC;",Production.WorkOrder,success,238,,"[3, 316, 324, 327, 328, 329, 330, 331, 350, 398]"
239,Find employees who are in the top 10% of vacation hour earners.,"SELECT BusinessEntityID, VacationHours FROM (SELECT BusinessEntityID, VacationHours, PERCENT_RANK() OVER(ORDER BY VacationHours) AS Pr FROM HumanResources.Employee) AS t WHERE Pr >= 0.9;",HumanResources.Employee,success,27,,"[1, 88, 89, 90, 91, 92, 103, 104, 106, 107]"
240,"Get the total revenue generated by each Sales Person, including their first and last name.","SELECT p.FirstName, p.LastName, SUM(soh.TotalDue) AS Revenue FROM Sales.SalesOrderHeader soh JOIN Person.Person p ON soh.SalesPersonID = p.BusinessEntityID GROUP BY p.FirstName, p.LastName;","Person.Person, Sales.SalesOrderHeader",success,17,,
241,Find products that are currently out of stock in all locations.,SELECT Name FROM Production.Product WHERE ProductID NOT IN (SELECT ProductID FROM Production.ProductInventory WHERE Quantity > 0);,"Production.Product, Production.ProductInventory",success,76,,
242,List the top 5 customers who spend the most on average per order.,"SELECT TOP 5 CustomerID, AVG(TotalDue) AS AvgSpend FROM Sales.SalesOrderHeader GROUP BY CustomerID ORDER BY AvgSpend DESC;",Sales.SalesOrderHeader,success,5,,"[29624, 29641, 29861, 29923, 29940]"
243,Find the number of employees who have the same birth date.,"SELECT BirthDate, COUNT(*) FROM HumanResources.Employee GROUP BY BirthDate HAVING COUNT(*) > 1;",HumanResources.Employee,success,15,,
244,Display product names that have a list price higher than the average list price of their own subcategory.,"SELECT p1.Name, p1.ListPrice FROM Production.Product p1 WHERE p1.ListPrice > (SELECT AVG(p2.ListPrice) FROM Production.Product p2 WHERE p2.ProductSubcategoryID = p1.ProductSubcategoryID);",Production.Product,success,116,,
245,List the most popular product by quantity sold in each territory.,"SELECT TerritoryID, ProductID, TotalQty FROM (SELECT soh.TerritoryID, sod.ProductID, SUM(sod.OrderQty) AS TotalQty, ROW_NUMBER() OVER(PARTITION BY soh.TerritoryID ORDER BY SUM(sod.OrderQty) DESC) AS RankVal FROM Sales.SalesOrderHeader soh JOIN Sales.SalesOrderDetail sod ON soh.SalesOrderID = sod.SalesOrderID GROUP BY soh.TerritoryID, sod.ProductID) AS t WHERE RankVal = 1;","Sales.SalesOrderDetail, Sales.SalesOrderHeader",success,10,,"[[1, 870], [2, 715], [3, 712], [4, 712], [5, 715], [6, 712], [7, 712], [8, 870], [9, 870], [10, 712]]"
246,Find all products whose name contains a number.,SELECT Name FROM Production.Product WHERE Name LIKE '%[0-9]%';,Production.Product,success,316,,
247,Calculate the ratio of scrapped quantity to total order quantity for each work order.,"SELECT WorkOrderID, (CAST(ScrappedQty AS float) / OrderQty) AS ScrapRatio FROM Production.WorkOrder WHERE OrderQty > 0;",Production.WorkOrder,success,1000,,"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
248,Show the total sales for each year and quarter.,"SELECT YEAR(OrderDate) AS Yr, DATEPART(quarter, OrderDate) AS Qtr, SUM(TotalDue) AS Revenue FROM Sales.SalesOrderHeader GROUP BY YEAR(OrderDate), DATEPART(quarter, OrderDate);",Sales.SalesOrderHeader,success,13,,
249,List names of people who have more than 3 phone numbers.,"SELECT p.FirstName, p.LastName FROM Person.Person p JOIN Person.PersonPhone pp ON p.BusinessEntityID = pp.BusinessEntityID GROUP BY p.FirstName, p.LastName HAVING COUNT(pp.PhoneNumber) > 3;","Person.Person, Person.PersonPhone",success,15,,
250,Find the average number of days it takes to ship an order for each territory.,"SELECT TerritoryID, AVG(DATEDIFF(day, OrderDate, ShipDate)) AS AvgLeadTime FROM Sales.SalesOrderHeader GROUP BY TerritoryID;",Sales.SalesOrderHeader,success,10,,"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
251,Use a Subquery to find the name of the product with the maximum quantity in a single inventory location.,SELECT Name FROM Production.Product WHERE ProductID = (SELECT TOP 1 ProductID FROM Production.ProductInventory ORDER BY Quantity DESC);,"Production.Product, Production.ProductInventory",success,1,,
252,List employees who have never taken a sick day.,SELECT * FROM HumanResources.Employee WHERE SickLeaveHours = 0;,HumanResources.Employee,success,0,,
253,Find the percentage of male vs female employees in the company.,"SELECT Gender, COUNT(*) * 100.0 / (SELECT COUNT(*) FROM HumanResources.Employee) AS Pct FROM HumanResources.Employee GROUP BY Gender;",HumanResources.Employee,success,2,,
254,Retrieve the list price of products and compare it with the previous product's list price in the same subcategory.,"SELECT Name, ProductSubcategoryID, ListPrice, LAG(ListPrice) OVER(PARTITION BY ProductSubcategoryID ORDER BY ListPrice) AS PrevPrice FROM Production.Product;",Production.Product,success,504,,"[null, null, null, null, null, null, null, null, null, null]"
255,List the orders where the subtotal is higher than the average subtotal of all orders in the same territory.,"SELECT SalesOrderID, TerritoryID, SubTotal FROM Sales.SalesOrderHeader s1 WHERE SubTotal > (SELECT AVG(SubTotal) FROM Sales.SalesOrderHeader s2 WHERE s2.TerritoryID = s1.TerritoryID);",Sales.SalesOrderHeader,success,1000,,"[[43659, 5], [43661, 6], [43662, 6], [43664, 1], [43665, 1], [43666, 4], [43668, 6], [43671, 1], [43672, 6], [43677, 6]]"
256,Find all vendors located in Australia.,SELECT v.Name FROM Purchasing.Vendor v JOIN Person.BusinessEntityAddress bea ON v.BusinessEntityID = bea.BusinessEntityID JOIN Person.Address a ON bea.AddressID = a.AddressID JOIN Person.StateProvince sp ON a.StateProvinceID = sp.StateProvinceID JOIN Person.CountryRegion cr ON sp.CountryRegionCode = cr.CountryRegionCode WHERE cr.Name = 'Australia';,"Person.Address, Person.BusinessEntityAddress, Person.CountryRegion, Person.StateProvince, Purchasing.Vendor",success,0,,
257,Calculate the total quantity of products ordered by month for the year 2012.,"SELECT MONTH(OrderDate) AS Mo, SUM(OrderQty) FROM Sales.SalesOrderHeader h JOIN Sales.SalesOrderDetail d ON h.SalesOrderID = d.SalesOrderID WHERE YEAR(OrderDate) = 2012 GROUP BY MONTH(OrderDate);","Sales.SalesOrderDetail, Sales.SalesOrderHeader",success,12,,
258,List products that have a product model but no catalog description.,SELECT Name FROM Production.ProductModel WHERE CatalogDescription IS NULL;,Production.ProductModel,success,122,,
259,Find customers who have purchased from both Bikes and Accessories categories.,SELECT CustomerID FROM Sales.SalesOrderHeader h JOIN Sales.SalesOrderDetail d ON h.SalesOrderID = d.SalesOrderID JOIN Production.Product p ON d.ProductID = p.ProductID JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID WHERE pc.Name = 'Bikes' INTERSECT SELECT CustomerID FROM Sales.SalesOrderHeader h JOIN Sales.SalesOrderDetail d ON h.SalesOrderID = d.SalesOrderID JOIN Production.Product p ON d.ProductID = p.ProductID JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID WHERE pc.Name = 'Accessories';,"Production.Product, Production.ProductCategory, Production.ProductSubcategory, Sales.SalesOrderDetail, Sales.SalesOrderHeader",success,1000,,"[11009, 11015, 11032, 11035, 11052, 11055, 11058, 11061, 11072, 11075]"
260,Show the most expensive order for each sales person.,"SELECT SalesPersonID, MAX(TotalDue) AS MaxOrder FROM Sales.SalesOrderHeader WHERE SalesPersonID IS NOT NULL GROUP BY SalesPersonID;",Sales.SalesOrderHeader,success,17,,"[274, 275, 276, 277, 278, 279, 280, 281, 282, 283]"
261,Rank products by their total revenue generated.,"SELECT ProductID, SUM(LineTotal) AS Revenue, RANK() OVER(ORDER BY SUM(LineTotal) DESC) AS RevRank FROM Sales.SalesOrderDetail GROUP BY ProductID;",Sales.SalesOrderDetail,success,266,,"[707, 708, 709, 710, 711, 712, 713, 714, 715, 716]"
262,Find all employees whose marital status is different from their manager's.,SELECT e.BusinessEntityID FROM HumanResources.Employee e JOIN HumanResources.Employee m ON e.OrganizationNode.GetAncestor(1) = m.OrganizationNode WHERE e.MaritalStatus <> m.MaritalStatus;,HumanResources.Employee,success,156,,"[3, 4, 8, 11, 12, 13, 14, 20, 21, 23]"
263,List the names of products that have been part of a 'Bill of Materials' as a component.,SELECT DISTINCT p.Name FROM Production.Product p JOIN Production.BillOfMaterials bom ON p.ProductID = bom.ComponentID;,"Production.BillOfMaterials, Production.Product",success,325,,
264,Calculate the average tax rate per country.,"SELECT cr.Name, AVG(tr.TaxRate) FROM Sales.SalesTaxRate tr JOIN Person.StateProvince sp ON tr.StateProvinceID = sp.StateProvinceID JOIN Person.CountryRegion cr ON sp.CountryRegionCode = cr.CountryRegionCode GROUP BY cr.Name;","Person.CountryRegion, Person.StateProvince, Sales.SalesTaxRate",success,6,,
265,Find the top selling product in the United States.,"SELECT TOP 1 p.Name, SUM(sod.OrderQty) AS TotalQty FROM Sales.SalesOrderDetail sod JOIN Production.Product p ON sod.ProductID = p.ProductID JOIN Sales.SalesOrderHeader soh ON sod.SalesOrderID = soh.SalesOrderID JOIN Sales.SalesTerritory st ON soh.TerritoryID = st.TerritoryID WHERE st.CountryRegionCode = 'US' GROUP BY p.Name ORDER BY TotalQty DESC;","Production.Product, Sales.SalesOrderDetail, Sales.SalesOrderHeader, Sales.SalesTerritory",success,1,,
266,Find the number of days between the first and last order of each customer.,"SELECT CustomerID, DATEDIFF(day, MIN(OrderDate), MAX(OrderDate)) AS CustomerLifespan FROM Sales.SalesOrderHeader GROUP BY CustomerID;",Sales.SalesOrderHeader,success,1000,,"[11035, 11052, 11098, 11115, 11158, 11161, 11178, 11218, 11224, 11238]"
267,List employees who work the night shift.,"SELECT p.FirstName, p.LastName FROM Person.Person p JOIN HumanResources.EmployeeDepartmentHistory edh ON p.BusinessEntityID = edh.BusinessEntityID JOIN HumanResources.Shift s ON edh.ShiftID = s.ShiftID WHERE s.Name = 'Night';","HumanResources.EmployeeDepartmentHistory, HumanResources.Shift, Person.Person",success,52,,
268,Find orders that contain more than 50 different items.,SELECT SalesOrderID FROM Sales.SalesOrderDetail GROUP BY SalesOrderID HAVING COUNT(SalesOrderDetailID) > 50;,Sales.SalesOrderDetail,success,145,,"[46608, 46614, 46616, 46625, 46638, 46657, 46662, 46666, 46668, 46669]"
269,Show the total amount of discounts given by each salesperson.,"SELECT soh.SalesPersonID, SUM(sod.UnitPrice * sod.UnitPriceDiscount * sod.OrderQty) AS TotalDiscount FROM Sales.SalesOrderHeader soh JOIN Sales.SalesOrderDetail sod ON soh.SalesOrderID = sod.SalesOrderID WHERE soh.SalesPersonID IS NOT NULL GROUP BY soh.SalesPersonID;","Sales.SalesOrderDetail, Sales.SalesOrderHeader",success,17,,"[274, 275, 276, 277, 278, 279, 280, 281, 282, 283]"
270,Identify products where the standard cost has increased by more than 20% in their history.,"SELECT ProductID FROM (SELECT ProductID, StandardCost, LEAD(StandardCost) OVER(PARTITION BY ProductID ORDER BY StartDate) AS NextCost FROM Production.ProductCostHistory) AS t WHERE NextCost > (StandardCost * 1.2);",Production.ProductCostHistory,success,25,,"[712, 713, 714, 715, 716, 717, 718, 719, 720, 721]"
271,List all departments and the total years of experience of employees in them.,"SELECT d.Name, SUM(DATEDIFF(year, e.HireDate, GETDATE())) AS TotalExperience FROM HumanResources.Department d JOIN HumanResources.EmployeeDepartmentHistory edh ON d.DepartmentID = edh.DepartmentID JOIN HumanResources.Employee e ON edh.BusinessEntityID = e.BusinessEntityID WHERE edh.EndDate IS NULL GROUP BY d.Name;","HumanResources.Department, HumanResources.Employee, HumanResources.EmployeeDepartmentHistory",success,16,,
272,Find customers whose total spending is in the top 5% of all customers.,"SELECT CustomerID FROM (SELECT CustomerID, SUM(TotalDue) AS TotalSpent, PERCENT_RANK() OVER(ORDER BY SUM(TotalDue)) AS Pr FROM Sales.SalesOrderHeader GROUP BY CustomerID) AS t WHERE Pr >= 0.95;",Sales.SalesOrderHeader,success,956,,"[11000, 11002, 11003, 11004, 11005, 11006, 11007, 11008, 11009, 11010]"
273,Show products that have exactly 3 reviews.,SELECT ProductID FROM Production.ProductReview GROUP BY ProductID HAVING COUNT(*) = 3;,Production.ProductReview,success,0,,
274,Find the Sales Person who has the most diverse territory coverage (most territories).,"SELECT TOP 1 BusinessEntityID, COUNT(TerritoryID) AS TerritoryCount FROM Sales.SalesTerritoryHistory GROUP BY BusinessEntityID ORDER BY TerritoryCount DESC;",Sales.SalesTerritoryHistory,success,1,,[275]
275,Calculate the monthly growth in sales revenue for the year 2013.,"WITH MonthlySales AS (SELECT MONTH(OrderDate) AS Mo, SUM(TotalDue) AS Rev FROM Sales.SalesOrderHeader WHERE YEAR(OrderDate) = 2013 GROUP BY MONTH(OrderDate)) SELECT Mo, Rev, Rev - LAG(Rev) OVER(ORDER BY Mo) AS Growth FROM MonthlySales;",Sales.SalesOrderHeader,success,12,,
276,List vendors who have a credit rating of 1 and provide at least one product with a list price > $500.,SELECT DISTINCT v.Name FROM Purchasing.Vendor v JOIN Purchasing.ProductVendor pv ON v.BusinessEntityID = pv.BusinessEntityID JOIN Production.Product p ON pv.ProductID = p.ProductID WHERE v.CreditRating = 1 AND p.ListPrice > 500;,"Production.Product, Purchasing.ProductVendor, Purchasing.Vendor",success,0,,
277,Find the first and last name of the person with the longest middle name.,"SELECT TOP 1 FirstName, MiddleName, LastName FROM Person.Person WHERE MiddleName IS NOT NULL ORDER BY LEN(MiddleName) DESC;",Person.Person,success,1,,
278,Show all products that have never been scrapped in any work order.,SELECT Name FROM Production.Product WHERE ProductID NOT IN (SELECT ProductID FROM Production.WorkOrder WHERE ScrappedQty > 0);,"Production.Product, Production.WorkOrder",success,337,,
279,Retrieve the average freight cost for orders shipped to each city.,"SELECT a.City, AVG(soh.Freight) FROM Sales.SalesOrderHeader soh JOIN Person.Address a ON soh.ShipToAddressID = a.AddressID GROUP BY a.City;","Person.Address, Sales.SalesOrderHeader",success,539,,
280,Find all employees whose salary has changed more than 3 times.,SELECT BusinessEntityID FROM HumanResources.EmployeePayHistory GROUP BY BusinessEntityID HAVING COUNT(*) > 3;,HumanResources.EmployeePayHistory,success,0,,
281,Calculate the average age of customers based on birth date (if available).,"SELECT AVG(DATEDIFF(year, BirthDate, GETDATE())) FROM Person.Person p JOIN Sales.Customer c ON p.BusinessEntityID = c.PersonID;","Person.Person, Sales.Customer","failed: ('42S22', ""[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'BirthDate'. (207) (SQLExecDirectW)"")",,,
282,List the sales order IDs where the total quantity of items is greater than the company average order quantity.,SELECT SalesOrderID FROM Sales.SalesOrderDetail GROUP BY SalesOrderID HAVING SUM(OrderQty) > (SELECT AVG(OrderQtySum) FROM (SELECT SUM(OrderQty) AS OrderQtySum FROM Sales.SalesOrderDetail GROUP BY SalesOrderID) AS t);,Sales.SalesOrderDetail,success,1000,,"[43659, 43661, 43662, 43664, 43665, 43668, 43671, 43672, 43673, 43675]"
283,Show names of departments that have never hired any male employees.,SELECT Name FROM HumanResources.Department WHERE DepartmentID NOT IN (SELECT edh.DepartmentID FROM HumanResources.EmployeeDepartmentHistory edh JOIN HumanResources.Employee e ON edh.BusinessEntityID = e.BusinessEntityID WHERE e.Gender = 'M');,"HumanResources.Department, HumanResources.Employee, HumanResources.EmployeeDepartmentHistory",success,0,,
284,Find products with the word Silver in their name but not Black.,SELECT Name FROM Production.Product WHERE Name LIKE '%Silver%' AND Name NOT LIKE '%Black%';,Production.Product,success,31,,
285,"List the top 3 territories by sales for each group (North America, Europe, etc.).","SELECT * FROM (SELECT [Group], Name, SalesYTD, ROW_NUMBER() OVER(PARTITION BY [Group] ORDER BY SalesYTD DESC) AS RankVal FROM Sales.SalesTerritory) AS t WHERE RankVal <= 3;",Sales.SalesTerritory,success,7,,
286,Show the total list price of all products in the Components category.,SELECT SUM(p.ListPrice) FROM Production.Product p JOIN Production.ProductSubcategory s ON p.ProductSubcategoryID = s.ProductSubcategoryID JOIN Production.ProductCategory c ON s.ProductCategoryID = c.ProductCategoryID WHERE c.Name = 'Components';,"Production.Product, Production.ProductCategory, Production.ProductSubcategory",success,,62961.2800,
287,"Find customers who have made purchases totaling more than $100,000 but only in a single year.","SELECT CustomerID FROM Sales.SalesOrderHeader GROUP BY CustomerID, YEAR(OrderDate) HAVING SUM(TotalDue) > 100000;",Sales.SalesOrderHeader,success,328,,"[29486, 29486, 29488, 29488, 29489, 29497, 29497, 29497, 29497, 29499]"
288,Find the shift with the least number of employees assigned.,"SELECT TOP 1 ShiftID, COUNT(*) FROM HumanResources.EmployeeDepartmentHistory GROUP BY ShiftID ORDER BY COUNT(*) ASC;",HumanResources.EmployeeDepartmentHistory,success,1,,[3]
289,List all products that are 'Red' and have a weight less than 10.,SELECT Name FROM Production.Product WHERE Color = 'Red' AND Weight < 10;,Production.Product,success,17,,
290,Display the person name and the number of days since their last modified date.,"SELECT FirstName, LastName, DATEDIFF(day, ModifiedDate, GETDATE()) AS DaysSinceModified FROM Person.Person;",Person.Person,success,1000,,
291,Find the average discount percentage for online vs offline orders.,"SELECT OnlineOrderFlag, AVG(so.DiscountPct) FROM Sales.SalesOrderHeader h JOIN Sales.SalesOrderDetail d ON h.SalesOrderID = d.SalesOrderID JOIN Sales.SpecialOffer so ON d.SpecialOfferID = so.SpecialOfferID GROUP BY OnlineOrderFlag;","Sales.SalesOrderDetail, Sales.SalesOrderHeader, Sales.SpecialOffer",success,2,,
292,List all addresses that have 'Suite' in their address line 2.,SELECT * FROM Person.Address WHERE AddressLine2 LIKE '%Suite%';,Person.Address,"failed: ('ODBC SQL type -151 is not yet supported.  column-index=6  type=-151', 'HY106')",,,
293,Show the salesperson with the highest bonus to sales ratio.,"SELECT TOP 1 BusinessEntityID, (Bonus / SalesYTD) AS BonusRatio FROM Sales.SalesPerson WHERE SalesYTD > 0 ORDER BY BonusRatio DESC;",Sales.SalesPerson,success,1,,[286]
294,Find the total number of products in each inventory shelf.,"SELECT Shelf, COUNT(ProductID) FROM Production.ProductInventory GROUP BY Shelf;",Production.ProductInventory,success,21,,
295,Retrieve the name of the product that has the largest bill of materials hierarchy level.,"SELECT TOP 1 p.Name, bom.BOMLevel FROM Production.Product p JOIN Production.BillOfMaterials bom ON p.ProductID = bom.ComponentID ORDER BY bom.BOMLevel DESC;","Production.BillOfMaterials, Production.Product",success,1,,
296,List orders that were paid with a Vista credit card.,SELECT oh.SalesOrderID FROM Sales.SalesOrderHeader oh JOIN Sales.CreditCard cc ON oh.CreditCardID = cc.CreditCardID WHERE cc.CardType = 'Vista';,"Sales.CreditCard, Sales.SalesOrderHeader",success,1000,,"[43660, 43663, 43665, 43666, 43669, 43670, 43671, 43672, 43673, 43675]"
297,Calculate the standard deviation of list prices for each category.,"SELECT pc.Name, STDEV(p.ListPrice) FROM Production.Product p JOIN Production.ProductSubcategory ps ON p.ProductSubcategoryID = ps.ProductSubcategoryID JOIN Production.ProductCategory pc ON ps.ProductCategoryID = pc.ProductCategoryID GROUP BY pc.Name;","Production.Product, Production.ProductCategory, Production.ProductSubcategory",success,4,,
298,Find employees who are currently on their second department in the company.,SELECT BusinessEntityID FROM HumanResources.EmployeeDepartmentHistory GROUP BY BusinessEntityID HAVING COUNT(DepartmentID) = 2;,HumanResources.EmployeeDepartmentHistory,success,4,,"[4, 16, 224, 234]"
299,Show product names that have more than one illustration assigned.,SELECT p.Name FROM Production.Product p JOIN Production.ProductModelIllustration pmi ON p.ProductModelID = pmi.ProductModelID GROUP BY p.Name HAVING COUNT(pmi.IllustrationID) > 1;,"Production.Product, Production.ProductModelIllustration",success,2,,
300,Find the month in 2011 with the lowest number of unique products sold.,"SELECT TOP 1 MONTH(OrderDate) AS Mo, COUNT(DISTINCT ProductID) AS UniqueProducts FROM Sales.SalesOrderHeader h JOIN Sales.SalesOrderDetail d ON h.SalesOrderID = d.SalesOrderID WHERE YEAR(OrderDate) = 2011 GROUP BY MONTH(OrderDate) ORDER BY UniqueProducts ASC;","Sales.SalesOrderDetail, Sales.SalesOrderHeader",success,1,,
